---
title: "Mini-Project 4"
author: "Harriet Brookes-Gray, Ellen Dong, Christina Hung"
date: "April 27, 2019"
output: 
  html_document:
    code_folding: hide
---
knitr::opts_chunk$set(echo = TRUE)
#Opening the libraries, getting scidb data
```{r, message = FALSE, warning = FALSE}
library(tidyverse)
library(RMySQL)
db <- dbConnect(MySQL(), 
                host = "scidb.smith.edu", 
                user = "mth292", 
                password = "RememberPi", 
                dbname = "citibike")
knitr::opts_chunk$set(connection = db, max.print = 20)
```

```{r}
library(leaflet)
library(sf)
```

```{sql connection = db}
#SQL Query to Join the Tables
SELECT station_id, name, avg_lat, avg_lon
FROM trips 
LEFT JOIN station_months ON trips.start_station_id = station_months.station_id
WHERE start_time > "2017-01-01 06:00:00" AND stop_time < "2017-01-01 10:00:00"
GROUP BY station_id
ORDER BY start_time;
```

```{sql connection = db}
#SQL Query to Join the Tables
SELECT COUNT(bike_id) AS number_of_bikes
FROM trips 
LEFT JOIN station_months ON trips.start_station_id = station_months.station_id
WHERE start_time > "2017-01-01 06:00:00" AND stop_time < "2017-01-01 10:00:00"
ORDER BY start_time;
```


```{r}
trips <- dbGetQuery(db, 
                    'SELECT station_id, name, avg_lat, avg_lon
                     FROM trips 
                     LEFT JOIN station_months ON trips.start_station_id = station_months.station_id
                     WHERE start_time > "2017-01-01 06:00:00" AND stop_time < "2017-01-01 10:00:00"
                     GROUP BY station_id
                    ORDER BY start_time;')
```

```{r}
trips_plot <- leaflet() %>%
  addTiles() %>%
  addCircleMarkers(data = trips, lng = ~avg_lon, lat = ~avg_lat, popup = ~name)

trips_plot
```

